<%- include('partials/header') %>

<div class="hub-container">
    
    <!-- Column 1: Action Items (no changes) -->
    <div class="hub-column">
        <h2>Action Items</h2>
        <div class="form-container">
            <form action="/weekly/action-items/add" method="POST">
                <input type="text" name="task" placeholder="New task description..." required>
                <input type="text" name="owner" placeholder="Owner (e.g., Alex)">
                <select name="priority" required>
                    <option value="High">High Priority</option>
                    <option value="Medium" selected>Medium Priority</option>
                    <option value="Low">Low Priority</option>
                </select>
                <button type="submit" class="btn-primary">Add Task</button>
            </form>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Owner</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% actionItems.forEach(item => { %>
                        <tr class="status-<%= item.status.replace(' ', '-').toLowerCase() %>">
                            <td><%= item.task %></td>
                            <td><%= item.owner %></td>
                            <td class="priority-<%= item.priority.toLowerCase() %>"><%= item.priority %></td>
                            <td>
                                <form action="/weekly/action-items/update/<%= item.id %>" method="POST">
                                    <select name="status" onchange="this.form.submit()">
                                        <option value="To Do" <%= item.status === 'To Do' ? 'selected' : '' %>>To Do</option>
                                        <option value="In Progress" <%= item.status === 'In Progress' ? 'selected' : '' %>>In Progress</option>
                                        <option value="Done" <%= item.status === 'Done' ? 'selected' : '' %>>Done</option>
                                    </select>
                                </form>
                            </td>
                            <td>
                                <form action="/weekly/action-items/delete/<%= item.id %>" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
                                    <button type="submit" class="btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Column 2: Meeting Notes -->
    <div class="hub-column">
        <h2>Meeting Notes</h2>
        <% if (locals.message) { %>
            <p class="message success"><%= message %></p>
        <% } %>

        <div class="form-container">
            <form action="/weekly/notes/add" method="POST">
                <textarea name="note" rows="5" placeholder="Add a new note for today's meeting..." required></textarea>
                <button type="submit" class="btn-primary">Save Note</button>
            </form>
        </div>

        <div class="notes-log">
            <% notes.forEach(note => { %>
                <div class="note-entry">
                    <!-- View Mode -->
                    <div id="note-view-<%= note.id %>">
                        <p class="note-date"><%= new Date(note.created_at).toLocaleDateString('en-US', { dateStyle: 'long' }) %></p>
                        <div class="note-content"><%- note.note.replace(/\n/g, '<br>') %></div>
                        <div class="note-actions">
                            <button type="button" class="btn-secondary" onclick="toggleEdit(<%= note.id %>, true)">Edit</button>
                            <form action="/weekly/notes/delete/<%= note.id %>" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this note?');">
                                <button type="submit" class="btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                    <!-- Edit Mode (hidden by default) -->
                    <form id="note-edit-<%= note.id %>" action="/weekly/notes/edit/<%= note.id %>" method="POST" style="display: none;">
                        <textarea name="note" rows="5"><%= note.note %></textarea>
                        <div class="note-actions">
                            <button type="submit" class="btn-primary">Save</button>
                            <button type="button" class="btn-secondary" onclick="toggleEdit(<%= note.id %>, false)">Cancel</button>
                        </div>
                    </form>
                </div>
            <% }) %>
        </div>
    </div>

</div>

<%- include('partials/footer') %>

<script>
    // JavaScript to toggle between view and edit modes for notes
    function toggleEdit(noteId, isEditing) {
        const viewMode = document.getElementById(`note-view-${noteId}`);
        const editMode = document.getElementById(`note-edit-${noteId}`);
        if (isEditing) {
            viewMode.style.display = 'none';
            editMode.style.display = 'block';
        } else {
            viewMode.style.display = 'block';
            editMode.style.display = 'none';
        }
    }
</script>

<style>
    .hub-container { display: flex; gap: 2rem; flex-wrap: wrap; }
    .hub-column { flex: 1; min-width: 400px; }
    .form-container { background-color: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
    .form-container input, .form-container select, .form-container textarea { width: 100%; padding: 0.5rem; margin-bottom: 1rem; box-sizing: border-box; }
    .btn-primary, .btn-danger, .btn-secondary { padding: 0.5rem 1rem; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold; }
    .btn-primary { background-color: #007bff; }
    .btn-danger { background-color: #dc3545; }
    .btn-secondary { background-color: #6c757d; }
    .table-container { margin-top: 0; }
    .priority-high { color: #dc3545; font-weight: bold; }
    .priority-medium { color: #fd7e14; }
    .priority-low { color: #6c757d; }
    .status-done { text-decoration: line-through; color: #6c757d; }
    .notes-log { display: flex; flex-direction: column; gap: 1.5rem; }
    .note-entry { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background-color: #ffffff; }
    .note-date { font-weight: bold; margin: 0 0 0.5rem 0; font-size: 0.9rem; color: #333; }
    .note-content { font-size: 1rem; margin-bottom: 1rem; }
    .note-actions { display: flex; gap: 0.5rem; }
    .message.success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem; }
</style>
